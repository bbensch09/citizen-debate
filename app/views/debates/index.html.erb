<p id="notice"><%= notice %></p>

<div class="profile-container">

<h1 class="center debate-list-header">Your Pending Debate Challenges</h1>

<% if current_user && current_user.profile %>

<%= link_to 'Initiate a Debate', new_debate_path, class: "btn btn-default" %>

    <table class="col-lg-12 col-sm-12 waitlist-table">
      <thead>
        <tr>
          <th>Topic</th>
          <th>Creator</th>
          <th>Challenger</th>
          <th>Status</th>
          <th>Last Updated</th>
          <th colspan="3"></th>
        </tr>
      </thead>

      <tbody>
      <!-- new debate challenges -- to accept or reject -->
        <% @pending_debates.each do |debate| %>
          <tr>
            <td><%= link_to debate.topic.title, debate %></td>
            <td><%= debate.creator.profile.display_name %></td>
            <td>
              <% if debate.challenger && debate.challenger.profile %>
                  <%= debate.challenger.profile.display_name %>
                <% else %>
                "TBD"
              <% end %>
            </td>
            <td> <b> <%= debate.status %> </b> </td>
            <td><%= debate.time_since_updated %></td>
            <!-- <td><%= link_to 'Accept Challenge', schedule_debate_path(debate),  method: :get,  class: "btn btn-default" %></td> -->
            <td><%= link_to 'Accept Challenge', accept_challenge_debate_path(debate),  method: :post,  class: "btn btn-default" %></td>
          <% if current_user && current_user.email == "citizen.debate.16@gmail.com" %>
            <td><%= link_to 'Edit', edit_debate_path(debate) %></td>
            <td><%= link_to 'Destroy', debate, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          <% end %>
          </tr>
        <% end %>
        <!-- debates to be scheduled -->
        <% @debates_to_schedule.each do |debate| %>
          <tr>
            <td><%= link_to debate.topic.title, debate %></td>
            <td><%= debate.creator.profile.display_name %></td>
            <td>
              <% if debate.challenger.profile %>
                  <%= debate.challenger.profile.display_name %>
                <% else %>
                "TBD"
              <% end %>
            </td>
            <td> <b> <%= debate.status %> </b> </td>
            <td><%= debate.time_since_updated %></td>
            <td><%= link_to 'Schedule Debate', schedule_debate_path(debate),  method: :get,  class: "btn btn-default" %></td>
          <% if current_user && current_user.email == "citizen.debate.16@gmail.com" %>
            <td><%= link_to 'Edit', edit_debate_path(debate) %></td>
            <td><%= link_to 'Destroy', debate, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
<% elsif current_user %>
  <h3 class="alert-warning">
      In order to initiate or accept debate challenges, you must first complete your profile by selecting an alias and choosing a profile photo.
  </h3>
  <h4 class="center">
    <a class="btn btn-default" href='/profiles/new' > Complete profile</a>
  </h4>
<% else %>
  <h3 class="alert-warning"> You must be logged in to see pending debate challenges or to initiate a new debate. </h3>
  <h4>
    <%= link_to 'Sign up', new_user_registration_path, class: "btn btn-default" %>
    <%= link_to 'Log in', new_user_session_path, class: "btn btn-default" %>
  </h4>
<% end %>

<h1 class="center debate-list-header">Recently Completed Debates</h1>

<table class="col-lg-12 col-sm-12 waitlist-table">
  <thead>
    <tr>
      <th>Topic</th>
      <th>Affirmative</th>
      <th>Negative</th>
      <!-- <th>Net Delta</th> -->
      <th>Posted</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @completed_debates.each do |debate| %>
      <tr>
        <td><%= link_to debate.topic.title, debate %></td>
        <td><%= debate.affirmative_debater.user.profile.display_name %> <br> <%= debate.affirmative_debater.user.profile.civility_rating %> stars</td>
        <td><%= debate.negative_debater.user.profile.display_name %> <br> <%= debate.negative_debater.user.profile.civility_rating %> stars</td>
        <!-- <td><%= debate.negative_debater.user.profile.minds_changed %></td> -->
        <!-- <td><%= (debate.affirmative_debater.user.profile.minds_changed - debate.negative_debater.user.profile.minds_changed) %> minds</td> -->
        <td><%= debate.time_since_updated %></td>
      <% if current_user && current_user.email == "citizen.debate.16@gmail.com" %>
        <td><%= link_to 'Show', debate %></td>
        <td><%= link_to 'Edit', edit_debate_path(debate) %></td>
        <td><%= link_to 'Notify Followers', notify_followers_debate_path(debate) %></td>
        <td><%= link_to 'Destroy', debate, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

<h1 class="center debate-list-header">In-progress Debates</h1>

<table class="col-lg-12 col-sm-12 waitlist-table">
  <thead>
    <tr>
      <th>Topic</th>
      <th>Affirmative</th>
      <th>Negative</th>
      <th>Current Round</th>
      <th>Last Updated</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @active_debates.each do |debate| %>
      <tr>
        <td><%= link_to debate.topic.title, debate %></td>
        <td><%= debate.affirmative_debater.user.profile.display_name %></td>
        <td><%= debate.negative_debater.user.profile.display_name %></td>
        <td> <b> <%= debate.rounds.last.round_number %> </b> </td>
        <td><%= debate.time_since_updated %></td>
      <% if current_user && current_user.email == "citizen.debate.16@gmail.com" %>
        <td><%= link_to 'Show', debate %></td>
        <td><%= link_to 'Edit', edit_debate_path(debate) %></td>
        <td><%= link_to 'Destroy', debate, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

</div>
